import{useEffect as O}from"react";import{useForm as J}from"react-hook-form";import{useForm as X,useWarnAboutChange as Z}from"@refinedev/core";var V=({refineCoreProps:b,warnWhenUnsavedChanges:x,...T}={})=>{let{warnWhenUnsavedChanges:y,setWarnWhen:i}=Z(),D=x??y,m=X({...b}),{queryResult:u,onFinish:F,formLoading:o}=m,E=J({...T}),{watch:n,setValue:r,getValues:f,handleSubmit:e}=E;O(()=>{var c;let t=(c=u==null?void 0:u.data)==null?void 0:c.data;if(!t)return;let p=Object.keys(f());Object.entries(t).forEach(([H,P])=>{let R=H;p.includes(R)&&r(R,P)})},[u==null?void 0:u.data,r,f]),O(()=>{let t=n((p,{type:c})=>{c==="change"&&d(p)});return()=>t.unsubscribe()},[n]);let d=t=>(D&&i(!0),t),s=(t,p)=>async c=>(i(!1),e(t,p)(c));return{...E,handleSubmit:s,refineCore:m,saveButtonProps:{disabled:o,onClick:t=>{s(F,()=>!1)(t)}}}};import{useEffect as _,useState as q}from"react";var L=({stepsProps:b,...x}={})=>{let{defaultStep:T=0,isBackValidate:y=!1}=b??{},[i,D]=q(T),m=V({...x}),{trigger:u,getValues:F,setValue:o,formState:{dirtyFields:E},refineCore:{queryResult:n}}=m;_(()=>{var s;let e=(s=n==null?void 0:n.data)==null?void 0:s.data;if(!e)return;let d=Object.keys(F());Object.entries(e).forEach(([C,t])=>{let p=C;d.includes(p)&&(E[p]||o(p,t))})},[n==null?void 0:n.data,i,o,F]);let r=e=>{let d=e;e<0&&(d=0),D(d)};return{...m,steps:{currentStep:i,gotoStep:async e=>{if(e===i)return;if(e<i&&!y){r(e);return}await u()&&r(e)}}}};import{useCallback as K}from"react";import{useGo as ee,useModal as re,useParsed as se,useResource as oe,userFriendlyResourceName as te,useTranslate as ae,useWarnAboutChange as ne}from"@refinedev/core";import g from"react";var Te=({modalProps:b,refineCoreProps:x,syncWithLocation:T,...y}={})=>{var j,W;let[i,D]=g.useState(!1),m=ae(),{resource:u,action:F}=x??{},{resource:o,action:E,identifier:n}=oe(u),r=se(),f=ee(),e=F??E??"",d=!(typeof T=="object"&&(T==null?void 0:T.syncId)===!1),s=typeof T=="object"&&"key"in T?T.key:o&&e&&T?`modal-${n}-${e}`:void 0,{defaultVisible:C=!1,autoSubmitClose:t=!0,autoResetForm:p=!0}=b??{},c=V({refineCoreProps:x,...y}),{reset:H,refineCore:{onFinish:P,id:R,setId:l},saveButtonProps:A,handleSubmit:G}=c,{visible:B,show:U,close:v}=re({defaultVisible:C});g.useEffect(()=>{var a,Q,S,M;if(i===!1&&s){let h=(Q=(a=r==null?void 0:r.params)==null?void 0:a[s])==null?void 0:Q.open;if(typeof h=="boolean"?h&&U():typeof h=="string"&&h==="true"&&U(),d){let $=(M=(S=r==null?void 0:r.params)==null?void 0:S[s])==null?void 0:M.id;$&&(l==null||l($))}D(!0)}},[s,r,d,l]),g.useEffect(()=>{var a;i===!0&&(B&&s?f({query:{[s]:{...(a=r==null?void 0:r.params)==null?void 0:a[s],open:!0,...d&&R&&{id:R}}},options:{keepQuery:!0},type:"replace"}):s&&!B&&f({query:{[s]:void 0},options:{keepQuery:!0},type:"replace"}))},[R,B,U,s,d]);let k=async a=>{await P(a),t&&v(),p&&H()},{warnWhen:w,setWarnWhen:N}=ne(),Y=K(()=>{if(w)if(window.confirm(m("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))N(!1);else return;l==null||l(void 0),v()},[w]),z=K(a=>{typeof a<"u"&&(l==null||l(a)),(!(e==="edit"||e==="clone")||(typeof a<"u"||typeof R<"u"))&&U()},[R]),I=m(`${n}.titles.${F}`,void 0,`${te(`${F} ${((j=o==null?void 0:o.meta)==null?void 0:j.label)??((W=o==null?void 0:o.options)==null?void 0:W.label)??(o==null?void 0:o.label)??n}`,"singular")}`);return{modal:{submit:k,close:Y,show:z,visible:B,title:I},...c,saveButtonProps:{...A,onClick:a=>G(k)(a)}}};export{V as useForm,Te as useModalForm,L as useStepsForm};
//# sourceMappingURL=index.js.map